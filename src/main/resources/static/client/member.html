<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>會員中心 - SnackForest</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="client.css">
</head>
<body>
    <nav class="navbar navbar-light bg-white shadow-sm mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold text-success" href="client.html">🌲 SnackForest</a>
            <a href="/logout" class="btn btn-outline-danger btn-sm">登出</a>
        </div>
    </nav>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-person-circle me-2"></i>會員中心</h5>
                    </div>
                    <div class="card-body text-center py-5">
                        <h3 class="mb-3">歡迎回來！</h3>
                        <p class="text-muted">這裡是您的會員中心，您可以在此查看訂單狀態。</p>
                        
                        <div class="row mt-4 g-3">
                            <div class="col-md-6">
                                <div class="p-3 border rounded bg-light">
                                    <h5>歷史訂單</h5>
                                    <p class="mb-0 text-muted">查看過去購買紀錄 (開發中)</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="p-3 border rounded bg-light" style="cursor: pointer;" onclick="openProfileModal()">
                                    <h5><i class="bi bi-gear-fill me-2"></i>帳戶設定</h5>
                                    <p class="mb-0 text-muted">點擊修改個人資料與密碼</p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <a href="client.html" class="btn btn-outline-success">繼續購物</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 編輯個人資料 Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">編輯個人資料</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="profileForm">
                        <div class="mb-3">
                            <label class="form-label">姓名</label>
                            <input type="text" class="form-control" id="pName">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="pEmail">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">電話</label>
                            <input type="text" class="form-control" id="pPhone">
                        </div>
                        <hr>
                        <div class="mb-3">
                            <label class="form-label">新密碼 (若不修改請留空)</label>
                            <input type="password" class="form-control" id="pPassword" placeholder="輸入新密碼">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-success" onclick="saveProfile()">儲存變更</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const profileModal = new bootstrap.Modal(document.getElementById('profileModal'));

        function openProfileModal() {
            // 載入當前資料
            fetch('/api/me').then(res => res.json()).then(data => {
                if(data.loggedIn) {
                    document.getElementById('pName').value = data.name || '';
                    document.getElementById('pEmail').value = data.email || '';
                    document.getElementById('pPhone').value = data.phone || '';
                    document.getElementById('pPassword').value = ''; // 清空密碼欄位
                    profileModal.show();
                } else {
                    alert('請先登入');
                    window.location.href = 'login.html';
                }
            });
        }

        function saveProfile() {
            const data = {
                name: document.getElementById('pName').value,
                email: document.getElementById('pEmail').value,
                phone: document.getElementById('pPhone').value,
                password: document.getElementById('pPassword').value
            };
            
            fetch('/api/me', {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            }).then(res => {
                if(res.ok) {
                    alert('更新成功！');
                    profileModal.hide();
                } else {
                    res.text().then(msg => alert('更新失敗: ' + msg));
                }
            });
        }
    </script>
</body>
</html>