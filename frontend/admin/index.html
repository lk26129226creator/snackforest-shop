<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>SnackForest 管理端</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="icon" href="data:,">
<link rel="stylesheet" href="css/admin.css">
</head>
<body class="admin-sidebar-collapsed">

<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
  <div class="container-fluid">
    <div class="d-flex align-items-center gap-3">
  <button class="navbar-hamburger" id="admin-menu-button" type="button" aria-label="開啟選單" aria-expanded="false" aria-controls="admin-sidebar">
        <span></span>
        <span></span>
        <span></span>
      </button>
    <a class="navbar-brand" href="#" id="admin-home-link">SnackForest 管理後台</a>
    </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0 admin-main-nav">
        <li class="nav-item"><a class="nav-link" href="#" id="nav-dashboard" data-target-section="dashboard-section">管理首頁</a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="nav-products" data-target-section="products-section">商品管理</a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="nav-categories" data-target-section="categories-section">分類管理</a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="nav-orders" data-target-section="orders-section">訂單管理</a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="nav-carousel" data-target-section="carousel-section">輪播管理</a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="nav-site" data-target-section="site-section">網站設定</a></li>
      </ul>
      <button class="btn btn-outline-light" type="button" onclick="logout()">登出</button>
    </div>
  </div>
</nav>

<div class="admin-shell">
  <aside class="admin-sidebar" id="admin-sidebar" aria-label="管理選單">
    <div class="admin-sidebar-scroll">
      <div class="admin-sidebar-section">
        <button class="admin-sidebar-link" type="button" data-target-section="dashboard-section" aria-label="管理首頁" title="管理首頁">
          <i class="bi bi-speedometer2 admin-sidebar-icon" aria-hidden="true"></i>
          <span class="admin-sidebar-text">管理首頁</span>
        </button>
        <button class="admin-sidebar-link" type="button" data-target-section="products-section" aria-label="商品管理" title="商品管理">
          <i class="bi bi-box-seam admin-sidebar-icon" aria-hidden="true"></i>
          <span class="admin-sidebar-text">商品管理</span>
        </button>
        <button class="admin-sidebar-link" type="button" data-target-section="categories-section" aria-label="分類管理" title="分類管理">
          <i class="bi bi-collection admin-sidebar-icon" aria-hidden="true"></i>
          <span class="admin-sidebar-text">分類管理</span>
        </button>
        <button class="admin-sidebar-link" type="button" data-target-section="orders-section" aria-label="訂單管理" title="訂單管理">
          <i class="bi bi-receipt-cutoff admin-sidebar-icon" aria-hidden="true"></i>
          <span class="admin-sidebar-text">訂單管理</span>
        </button>
        <button class="admin-sidebar-link" type="button" data-target-section="carousel-section" aria-label="輪播管理" title="輪播管理">
          <i class="bi bi-images admin-sidebar-icon" aria-hidden="true"></i>
          <span class="admin-sidebar-text">輪播管理</span>
        </button>
        <button class="admin-sidebar-link" type="button" data-target-section="site-section" aria-label="網站設定" title="網站設定">
          <i class="bi bi-gear admin-sidebar-icon" aria-hidden="true"></i>
          <span class="admin-sidebar-text">網站設定</span>
        </button>
      </div>
      <div class="admin-sidebar-section admin-sidebar-actions">
        <button class="admin-sidebar-link" type="button" onclick="logout()" aria-label="登出" title="登出">
          <i class="bi bi-box-arrow-right admin-sidebar-icon" aria-hidden="true"></i>
          <span class="admin-sidebar-text">登出</span>
        </button>
      </div>
    </div>
  </aside>
  <div class="admin-sidebar-backdrop" id="admin-sidebar-backdrop" hidden data-close-admin-sidebar></div>
  <main class="main-content">
  <div id="dashboard-section" class="admin-section active">
    <div class="vstack gap-4">
      <div class="card admin-profile-card p-4">
        <div class="d-flex flex-column flex-md-row align-items-md-center gap-3">
          <div class="d-flex align-items-center gap-3">
            <div id="admin-profile-avatar" class="admin-profile-avatar">AD</div>
            <div>
              <h1 class="h4 fw-bold mb-1" id="admin-profile-name">管理者</h1>
              <p class="text-muted small mb-0">歡迎回到管理後台，祝您管理順利。</p>
            </div>
          </div>
          <div class="admin-profile-meta ms-md-auto w-100 w-md-auto">
            <div class="admin-profile-meta-row">
              <span class="admin-profile-meta-label">帳號</span>
              <span class="admin-profile-meta-value" id="admin-profile-username">admin</span>
            </div>
            <div class="admin-profile-meta-row">
              <span class="admin-profile-meta-label">身分</span>
              <span class="admin-profile-meta-value" id="admin-profile-role">系統管理者</span>
            </div>
          </div>
        </div>
      </div>

      <div class="card p-4">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
          <h2 class="h6 text-muted text-uppercase mb-0">營運概況</h2>
          <button class="btn btn-outline-primary btn-sm" type="button" id="dashboard-refresh">重新整理資料</button>
        </div>
        <hr/>
        <div class="admin-stat-grid">
          <div class="admin-stat-card">
            <div class="admin-stat-value" id="admin-stat-products">0</div>
            <div class="admin-stat-label">商品</div>
          </div>
          <div class="admin-stat-card">
            <div class="admin-stat-value" id="admin-stat-categories">0</div>
            <div class="admin-stat-label">分類</div>
          </div>
          <div class="admin-stat-card">
            <div class="admin-stat-value" id="admin-stat-orders">0</div>
            <div class="admin-stat-label">訂單</div>
          </div>
        </div>
      </div>

      <div class="card p-4">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
          <h2 class="h6 text-muted text-uppercase mb-0">常用操作</h2>
          <span class="text-muted small">掌握常用管理流程</span>
        </div>
        <hr/>
        <div class="admin-quick-grid">
          <div class="admin-quick-link">
            <div class="admin-quick-title">新增商品</div>
            <p class="text-muted small mb-3">快速建立新商品資訊並上傳圖片。</p>
            <button class="btn btn-sm btn-primary w-100" data-target-section="products-section">前往商品管理</button>
          </div>
          <div class="admin-quick-link">
            <div class="admin-quick-title">整理分類</div>
            <p class="text-muted small mb-3">管理商品分類，保持目錄清晰。</p>
            <button class="btn btn-sm btn-outline-primary w-100" data-target-section="categories-section">前往分類管理</button>
          </div>
          <div class="admin-quick-link">
            <div class="admin-quick-title">輪播與首頁內容</div>
            <p class="text-muted small mb-3">調整首頁輪播與精選商品設定。</p>
            <div class="d-grid gap-2">
              <button class="btn btn-sm btn-outline-primary" data-target-section="carousel-section">輪播管理</button>
              <button class="btn btn-sm btn-outline-primary" data-target-section="site-section">網站設定</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="products-section" class="admin-section">
    <h1>商品管理</h1>
    <section class="mb-4">
      <h2>新增商品</h2>
      <form id="product-form">
        <div class="mb-3">
          <label for="p-name" class="form-label">商品名稱</label>
          <input id="p-name" class="form-control" placeholder="商品名稱" required>
        </div>
        <div class="mb-3">
          <label for="p-price" class="form-label">價格</label>
          <input id="p-price" class="form-control" placeholder="價格" type="number" required>
        </div>
        <div class="mb-3">
          <label for="p-category" class="form-label">分類</label>
          <select id="p-category" class="form-select"></select>
        </div>
        <div class="mb-3">
          <label for="p-introduction" class="form-label">商品介紹</label>
          <textarea id="p-introduction" class="form-control" rows="3" placeholder="輸入商品介紹"></textarea>
        </div>
        <div class="mb-3">
          <label for="p-origin" class="form-label">產地</label>
          <input id="p-origin" class="form-control" placeholder="輸入產地，例如：台灣">
        </div>
        <div class="row g-2">
          <div class="col-md-6 mb-3">
            <label for="p-production-date" class="form-label">生產日期</label>
            <input id="p-production-date" type="date" class="form-control">
          </div>
          <div class="col-md-6 mb-3">
            <label for="p-expiry-date" class="form-label">有效期限</label>
            <input id="p-expiry-date" type="date" class="form-control">
          </div>
        </div>
        <div class="mb-3">
          <label for="p-image-upload" class="form-label">圖片</label>
          <input type="file" id="p-image-upload" class="form-control" accept="image/*" multiple>
          <input type="hidden" id="p-imageUrl" name="imageUrl">
          <div id="p-image-preview-container" class="mt-2 d-flex flex-wrap gap-2"></div>
        </div>
        <button type="submit" class="btn btn-primary">新增商品</button>
      </form>
    </section>

    <h2>商品列表</h2>
    <div class="mb-3">
      <input id="product-search" class="form-control" placeholder="搜尋商品名稱..." />
    </div>
    <div id="product-list">載入中...</div>
  </div>

  <div id="categories-section" class="admin-section">
    <h1>分類管理</h1>
    <section class="mb-4">
      <h2>新增分類</h2>
      <form id="category-form">
        <div class="mb-3">
          <label for="c-name" class="form-label">分類名稱</label>
          <input id="c-name" class="form-control" placeholder="分類名稱" required>
        </div>
        <button type="submit" class="btn btn-primary">新增分類</button>
      </form>
    </section>

    <h2>分類列表</h2>
    <div id="category-list">載入中...</div>
  </div>

  <div id="orders-section" class="admin-section">
    <h1>訂單管理</h1>
    <h2>訂單列表</h2>
    <div id="order-list">載入中...</div>
  </div>

  <div id="carousel-section" class="admin-section">
    <h1>輪播管理</h1>
    <p class="text-muted">輪播設定已改為儲存在後端（/api/carousel），全站共用。</p>

    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <button id="carousel-add-btn" type="button" class="btn btn-sm btn-primary">新增一張</button>
        <button id="carousel-save-btn" type="button" class="btn btn-sm btn-success ms-2">儲存變更</button>
      </div>
      <div class="text-muted small">建議尺寸：1200x380（或相同寬高比）</div>
    </div>

    <div id="carousel-editor-list" class="list-group mb-4"></div>

    <div class="alert alert-info">小提示：點「儲存變更」後，回到首頁重新整理即可看到更新的輪播內容。</div>
  </div>

  <div id="site-section" class="admin-section">
    <h1 class="mb-3">網站設定</h1>
    <div class="vstack gap-4">
      <div class="card p-3">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
          <h5 class="mb-0">品牌外觀</h5>
          <button id="site-branding-save" type="button" class="btn btn-primary btn-sm">儲存</button>
        </div>
        <hr/>
        <div class="row g-3 align-items-center">
          <div class="col-12 col-md-6">
            <label class="form-label" for="site-branding-name">品牌名稱</label>
            <input id="site-branding-name" class="form-control" placeholder="例如：SnackForest">
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label" for="site-branding-tagline">品牌標語</label>
            <input id="site-branding-tagline" class="form-control" placeholder="例如：探索零食世界">
          </div>
          <div class="col-12">
            <label class="form-label" for="site-branding-logo">側欄 Logo 圖片 URL</label>
            <div class="input-group">
              <input id="site-branding-logo" class="form-control" placeholder="https:// 或 /frontend/images/...">
              <button id="site-branding-upload" type="button" class="btn btn-outline-secondary">上傳圖片</button>
            </div>
            <input type="file" id="site-branding-logo-file" class="d-none" accept="image/*">
            <div class="mt-3 text-center">
              <img id="site-branding-logo-preview" src="" alt="Logo 預覽" class="img-fluid rounded border d-none" style="max-height:120px; object-fit:contain;" hidden>
            </div>
            <div class="form-text">建議使用正方形 PNG 或 SVG，會同步顯示於客戶端側欄與導覽列。</div>
          </div>
        </div>
      </div>

      <div class="card p-3">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
          <h5 class="mb-0">首頁 Hero</h5>
          <div class="d-flex gap-2">
            <button id="site-hero-reset" type="button" class="btn btn-outline-secondary btn-sm">套用預設</button>
            <button id="site-hero-save" type="button" class="btn btn-primary btn-sm">儲存</button>
          </div>
        </div>
        <hr/>
        <div class="vstack gap-3">
          <div>
            <label class="form-label" for="site-hero-title">主標題</label>
            <input id="site-hero-title" class="form-control" placeholder="例如：探索世界零食的靈感地圖">
          </div>
          <div>
            <label class="form-label" for="site-hero-subtitle">副標題</label>
            <input id="site-hero-subtitle" class="form-control" placeholder="例如：精挑細選、快速到貨、安心付款">
          </div>
          <div>
            <label class="form-label" for="site-hero-primary-text">主按鈕文字</label>
            <input id="site-hero-primary-text" class="form-control" placeholder="例如：開始購物">
          </div>
          <div>
            <label class="form-label" for="site-hero-primary-link">主按鈕連結</label>
            <input id="site-hero-primary-link" class="form-control" placeholder="例如：product.html">
          </div>
          <div>
            <label class="form-label" for="site-hero-secondary-text">次按鈕文字</label>
            <input id="site-hero-secondary-text" class="form-control" placeholder="例如：逛逛全部">
          </div>
          <div>
            <label class="form-label" for="site-hero-secondary-link">次按鈕連結</label>
            <input id="site-hero-secondary-link" class="form-control" placeholder="例如：product.html?category=all">
          </div>
          <div>
            <label class="form-label" for="site-hero-image">Hero 圖片 URL</label>
            <div class="input-group">
              <input id="site-hero-image" class="form-control" placeholder="https:// 或 /frontend/images/...">
              <button id="site-hero-upload" type="button" class="btn btn-outline-secondary">上傳圖片</button>
            </div>
            <input type="file" id="site-hero-image-file" class="d-none" accept="image/*">
            <div class="mt-3 text-center">
              <img id="site-hero-image-preview" src="" alt="Hero 預覽" class="img-fluid rounded border" style="max-height:220px; object-fit:cover; display:none;">
            </div>
            <div class="form-text">提示：若未填寫將沿用預設圖片，連結可使用相對路徑（例如 product.html）。</div>
          </div>
        </div>
      </div>

      <div class="card p-3 d-flex flex-column">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
          <h5 class="mb-0">首頁亮點（四格特色）</h5>
          <div class="d-flex gap-2">
            <button id="site-benefit-add" type="button" class="btn btn-outline-secondary btn-sm">新增一則</button>
            <button id="site-benefit-save" type="button" class="btn btn-success btn-sm">儲存</button>
          </div>
        </div>
        <hr/>
        <p class="text-muted small mb-3">Icon 欄位填入 Font Awesome 名稱（例如 <code>truck-fast</code>）。未輸入的項目將不會顯示。</p>
        <div id="site-benefit-list" class="vstack gap-3 flex-grow-1"></div>
      </div>

      <div class="card p-3 d-flex flex-column">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
          <h5 class="mb-0">首頁精選商品</h5>
          <button id="site-featured-save" type="button" class="btn btn-success btn-sm">儲存</button>
        </div>
        <hr/>
        <p class="text-muted small mb-2">勾選要在首頁「精選商品」區塊顯示的商品，可拖曳已選卡片或使用上下箭頭調整顯示順序。</p>
        <div id="site-featured-list" class="vstack gap-2 flex-grow-1"></div>
      </div>

      <div class="card p-3 d-flex flex-column">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
          <h5 class="mb-0">網站頁腳</h5>
          <button id="site-footer-save" type="button" class="btn btn-success btn-sm">儲存</button>
        </div>
        <hr/>
        <div class="mb-3">
          <label class="form-label" for="site-footer-text">頁腳文字</label>
          <textarea id="site-footer-text" class="form-control" rows="3" placeholder="例如：© 2025 SnackForest. 保留所有權利。"></textarea>
          <div class="form-text">支援換行；頁腳背景固定為深灰色。</div>
        </div>
        <div id="site-footer-preview" class="site-footer-preview text-center">© 2025 SnackForest. 保留所有權利。</div>
      </div>
    </div>
  </div>
  </main>
</div>

<!-- Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProductModalLabel">編輯商品</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="edit-product-form">
          <input type="hidden" id="edit-p-id">
          <div class="mb-3">
            <label for="edit-p-name" class="form-label">商品名稱</label>
            <input type="text" class="form-control" id="edit-p-name" required>
          </div>
          <div class="mb-3">
            <label for="edit-p-price" class="form-label">價格</label>
            <input type="number" class="form-control" id="edit-p-price" required>
          </div>
          <div class="mb-3">
            <label for="edit-p-category" class="form-label">分類</label>
            <select class="form-select" id="edit-p-category" required></select>
          </div>
          <div class="mb-3">
            <label for="edit-p-introduction" class="form-label">商品介紹</label>
            <textarea id="edit-p-introduction" class="form-control" rows="3" placeholder="輸入商品介紹"></textarea>
          </div>
          <div class="mb-3">
            <label for="edit-p-origin" class="form-label">產地</label>
            <input id="edit-p-origin" class="form-control" placeholder="輸入產地，例如：台灣">
          </div>
          <div class="row g-2">
            <div class="col-md-6 mb-3">
                <label for="edit-p-production-date" class="form-label">生產日期</label>
                <input id="edit-p-production-date" type="date" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label for="edit-p-expiry-date" class="form-label">有效期限</label>
                <input id="edit-p-expiry-date" type="date" class="form-control">
            </div>
          </div>
          <div class="mb-3">
            <label for="edit-p-image-upload" class="form-label">圖片</label>
            <input type="file" id="edit-p-image-upload" class="form-control" accept="image/*" multiple>
            <input type="hidden" id="edit-p-imageUrl" name="imageUrl">
            <div id="edit-p-image-preview-container" class="mt-2 d-flex flex-wrap gap-2"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" id="save-edit-product-btn">儲存變更</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Category Modal -->
<div class="modal fade" id="editCategoryModal" tabindex="-1" aria-labelledby="editCategoryModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editCategoryModalLabel">編輯分類</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="edit-category-form">
          <input type="hidden" id="edit-c-id">
          <div class="mb-3">
            <label for="edit-c-name" class="form-label">分類名稱</label>
            <input type="text" class="form-control" id="edit-c-name" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" id="save-edit-category-btn">儲存變更</button>
      </div>
    </div>
  </div>
</div>

<!-- Image View Modal (full viewer with thumbnails on the right) -->
<div class="modal fade" id="imageViewModal" tabindex="-1" aria-labelledby="imageViewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="imageViewModalLabel">查看圖片</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-0">
        <div class="image-viewer">
          <div class="iv-wrapper">
            <div class="iv-main text-center d-flex flex-column">
              <div class="iv-main-img-wrap flex-grow-1 d-flex align-items-center justify-content-center">
                <img id="iv-main-img" src="" alt="產品圖片" />
              </div>
              <div class="iv-thumbs-wrapper mt-2 d-flex align-items-center justify-content-center">
                <button id="iv-thumb-prev" class="btn btn-outline-secondary thumb-nav me-2" aria-label="上一張">◀</button>
                <div class="iv-thumbs mt-0 d-flex align-items-center" id="iv-thumbs">
                  <!-- thumbnails injected here (horizontal) -->
                </div>
                <button id="iv-thumb-next" class="btn btn-outline-secondary thumb-nav ms-2" aria-label="下一張">▶</button>
              </div>
            </div>
            <aside class="iv-sidebar d-flex flex-column align-items-center">
              <!-- operation buttons (download/delete) could go here -->
            </aside>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
